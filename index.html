<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
        h1 {
            text-align: center;
            font-size: 24px;
            color: #e74c3c;
        }
        h2 {
            color: #e74c3c;
            font-size: 20px;
        }
        .calculator, .converter, .history, .feet-inches-converter, .decimal-feet-converter {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .calc-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .calc-input {
            display: flex;
            align-items: center;
        }
        input, select {
            margin: 0 5px;
            padding: 5px;
        }
        input[type="number"], input[type="text"] {
            width: 80px;
        }
        select {
            width: 50px;
        }
        button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px 0;
        }
        button:hover {
            background-color: #c0392b;
        }
        #history {
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Construction Calculator</h1>
    
    <div class="calculator">
        <h2>Feet and Inches Calculator</h2>
        <div class="calc-row">
            <div class="calc-input">
                <input type="number" id="feet1" placeholder="Feet"> feet
                <input type="text" id="inches1" placeholder="Inches"> inches
            </div>
            <select id="operation">
                <option value="+">+</option>
                <option value="-">-</option>
                <option value="*">×</option>
                <option value="/">÷</option>
            </select>
            <div class="calc-input">
                <input type="number" id="feet2" placeholder="Feet"> feet
                <input type="text" id="inches2" placeholder="Inches"> inches
            </div>
            <button id="calculateBtn">Calculate</button>
        </div>
        <p id="result"></p>
    </div>

    <div class="converter">
        <h2>Standard to Metric Converter</h2>
        <div class="calc-row">
            <div class="calc-input">
                <input type="number" id="feetToConvert" placeholder="Feet"> feet
                <input type="text" id="inchesToConvert" placeholder="Inches"> inches
            </div>
            <button id="convertBtn">Convert to Metric</button>
        </div>
        <p id="metricResult"></p>
    </div>

    <div class="decimal-feet-converter">
        <h2>Feet and Inches to Decimal Feet</h2>
        <div class="calc-row">
            <div class="calc-input">
                <input type="number" id="feet" placeholder="Feet"> feet
                <input type="number" id="inches" placeholder="Inches"> inches
            </div>
            <button id="convertToDecimalFeetBtn">Convert to Decimal Feet</button>
        </div>
        <p id="decimal-feet-result"></p>
    </div>

    <div class="slope calculator">
        <h2>Slope Calculator</h2>
        <div class="calc-row">
            <div class="calc-input">
                <label for="slopeRiseFeet">Rise:</label>
                <input type="number" id="slopeRiseFeet" placeholder="Feet"> feet
                <input type="text" id="slopeRiseInches" placeholder="Inches"> inches
            </div>
            <div class="calc-input">
                <label for="slopeRunFeet">Run:</label>
                <input type="number" id="slopeRunFeet" placeholder="Feet"> feet
                <input type="text" id="slopeRunInches" placeholder="Inches"> inches
            </div>
            <button id="calculateSlopeBtn">Calculate Slope</button>
        </div>
        <pre id="slopeResult"></pre>
    </div>

    <div class="history">
        <h2>Calculation History</h2>
        <div id="history">
        </div>
        <button id="clearHistoryBtn">Clear History</button>
    </div>

    <script>
        let calculationHistory = [];

        function addToHistory(calculation) {
            calculationHistory.push(calculation);
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyElement = document.getElementById('history');
            historyElement.innerHTML = calculationHistory.map(calc => `<p>${calc}</p>`).join('');
        }

        function clearHistory() {
            calculationHistory = [];
            updateHistoryDisplay();
        }

        function parseFractionalInput(input) {
            input = input.trim();
            let total = 0;
            let parts = input.split(' ');
            
            for (let part of parts) {
                if (part.includes('/')) {
                    let [numerator, denominator] = part.split('/').map(num => parseFloat(num.trim()));
                    total += numerator / denominator;
                } else {
                    total += parseFloat(part) || 0;
                }
            }
            
            return total;
        }

        function roundToNearestFraction(decimal, denominator) {
            return Math.round(decimal * denominator) / denominator;
        }

function roundToNearestFraction(decimal, denominator) {
    return Math.round(decimal * denominator) / denominator;
}

function toConstructionFraction(decimal) {
    if (decimal == 0) return '0';
    const wholePart = Math.floor(decimal);
    let fractionalPart = decimal - wholePart;
    
    if (fractionalPart < 1/512) {  // Using 1/512 as the threshold for rounding to 0
        return wholePart.toString();
    }
    
    const fractions = [2, 4, 8, 16, 32, 64, 128, 256];
    let bestFraction = { numerator: 0, denominator: 256 };
    let smallestError = Infinity;

    for (let denominator of fractions) {
        const rounded = roundToNearestFraction(fractionalPart, denominator);
        const error = Math.abs(rounded - fractionalPart);
        
        if (error < smallestError) {
            smallestError = error;
            bestFraction = {
                numerator: Math.round(rounded * denominator),
                denominator: denominator
            };
        }
    }

    if (bestFraction.numerator === 0) {
        return wholePart.toString();
    }

    // Simplify the fraction
    const gcd = (a, b) => b ? gcd(b, a % b) : a;
    const divisor = gcd(bestFraction.numerator, bestFraction.denominator);
    bestFraction.numerator /= divisor;
    bestFraction.denominator /= divisor;

    if (wholePart > 0) {
        return `${wholePart} ${bestFraction.numerator}/${bestFraction.denominator}`;
    } else {
        return `${bestFraction.numerator}/${bestFraction.denominator}`;
    }
}

function formatResult(feet, inches) {
    const wholeFeet = Math.floor(feet);
    const totalInches = (feet - wholeFeet) * 12 + inches;
    const wholeInches = Math.floor(totalInches);
    const fractionalInches = totalInches - wholeInches;
    
    let result = '';
    if (wholeFeet > 0) {
        result += `${wholeFeet}'`;
    }
    if (wholeInches > 0 || fractionalInches > 0) {
        if (result) result += '-';
        result += toConstructionFraction(totalInches % 12) + '"';
    }
    return result || '0"';
}

        function calculate() {
            const feet1 = parseFloat(document.getElementById('feet1').value) || 0;
            const inches1 = parseFractionalInput(document.getElementById('inches1').value);
            const feet2 = parseFloat(document.getElementById('feet2').value) || 0;
            const inches2 = parseFractionalInput(document.getElementById('inches2').value);
            const operation = document.getElementById('operation').value;

            const totalInches1 = feet1 * 12 + inches1;
            const totalInches2 = feet2 * 12 + inches2;

            let result;
            switch (operation) {
                case '+':
                    result = totalInches1 + totalInches2;
                    break;
                case '-':
                    result = totalInches1 - totalInches2;
                    break;
                case '*':
                    result = totalInches1 * totalInches2;
                    break;
                case '/':
                    result = totalInches1 / totalInches2;
                    break;
            }

            const resultFeet = Math.floor(result / 12);
            const resultInches = result % 12;

            const resultText = `Result: ${formatResult(resultFeet, resultInches)}`;
            document.getElementById('result').textContent = resultText;

            const calculationText = `${formatResult(feet1, inches1)} ${operation} ${formatResult(feet2, inches2)} = ${formatResult(resultFeet, resultInches)}`;
            addToHistory(calculationText);
        }

        function convertToMetric() {
            const feet = parseFloat(document.getElementById('feetToConvert').value) || 0;
            const inches = parseFractionalInput(document.getElementById('inchesToConvert').value);

            const totalInches = feet * 12 + inches;
            const totalCentimeters = totalInches * 2.54;

            const meters = Math.floor(totalCentimeters / 100);
            const centimeters = totalCentimeters % 100;
            const millimeters = inches * 25.4;
            const kilometers = meters / 1000;

            const resultText = `Result:<br>${feet}'-${inches}" = ${millimeters.toFixed(Math.max(1, getDecimalPlaces(millimeters)))} mm<br>
            ${feet}'-${inches}" = ${centimeters.toFixed(Math.max(1, getDecimalPlaces(centimeters)))} cm<br>
            ${feet}'-${inches}" = ${meters.toFixed(Math.max(1, getDecimalPlaces(meters)))} m<br>
            ${feet}'-${inches}" = ${(meters / 1000).toFixed(Math.max(1, getDecimalPlaces(meters / 1000)))} km`;
            document.getElementById('metricResult').innerHTML = resultText;

            const conversionText = `${formatResult(feet, inches)} = ${meters.toFixed(Math.max(1, getDecimalPlaces(meters)))}m ${centimeters.toFixed(Math.max(1, getDecimalPlaces(centimeters)))}cm`;
            addToHistory(conversionText);
            }

            function getDecimalPlaces(number) {
                const stringNumber = number.toString();
                const decimalIndex = stringNumber.indexOf('.');
                if (decimalIndex === -1) {
                    return 0;
                }
                return Math.min(10, stringNumber.length - decimalIndex - 1);
            }

            function roundToNearestFraction(decimal, denominator) {
                return Math.round(decimal * denominator) / denominator;
            }

        function parseFeetAndInches(input) {
            const regex = /^(\d+)'?-?\s*(\d+\s+(\d+\/\d+)?"?|\d+\/\d+"?|(\d+\/\d+)"?)$/;
            const match = input.match(regex);
            
            if (!match) {
                throw new Error("Invalid input format");
            }
            
            let feet = parseInt(match[1]) || 0;
            let inches = 0;
            
            if (match[2]) {
                if (match[2].includes("/")) {
                    inches = parseFractionalInput(match[2]);
                } else {
                    inches = parseInt(match[2]);
                    if (match[3]) {
                        inches += parseFractionalInput(match[3]);
                    }
                }
            }
            
            return feet * 12 + inches;
        }

        function convertFeetAndInchesToMetric() {
            try {
                const input = document.getElementById('feetAndInches').value;
                const totalInches = parseFeetAndInches(input);
                const totalCentimeters = totalInches * 2.54;

                const meters = Math.floor(totalCentimeters / 100);
                const centimeters = totalCentimeters % 100;

                const resultText = `Result: ${meters} meters and ${centimeters.toFixed(2)} centimeters`;
                document.getElementById('feetInchesMetricResult').textContent = resultText;

                const formattedInput = formatResult(Math.floor(totalInches / 12), totalInches % 12);
                const conversionText = `${formattedInput} = ${meters}m ${centimeters.toFixed(2)}cm`;
                addToHistory(conversionText);
            } catch (error) {
                document.getElementById('feetInchesMetricResult').textContent = "Error: " + error.message;
            }
        }

        function convertToDecimalFeet() {
            const feet = parseFloat(document.getElementById('feet').value) || 0;
            const inches = parseFloat(document.getElementById('inches').value) || 0;
            const decimalFeet = feet + (inches / 12);
            const resultText = `Result: ${decimalFeet.toFixed(2)} ft`;
            document.getElementById('decimal-feet-result').textContent = resultText;

            const conversionText = `${feet}'-${inches}" = ${decimalFeet.toFixed(2)} ft`;
            addToHistory(conversionText);
        }

        function calculateSlope() {
            const riseFeet = parseFloat(document.getElementById('slopeRiseFeet').value) || 0;
            const riseInches = parseFractionalInput(document.getElementById('slopeRiseInches').value);
            const runFeet = parseFloat(document.getElementById('slopeRunFeet').value) || 0;
            const runInches = parseFractionalInput(document.getElementById('slopeRunInches').value);

            const totalRiseInches = riseFeet * 12 + riseInches;
            const totalRunInches = runFeet * 12 + runInches;

            if (totalRiseInches <= 0 || totalRunInches <= 0) {
                document.getElementById('slopeResult').textContent = "Please enter valid positive numbers for rise and run.";
                return;
            }

            const slope = totalRiseInches / totalRunInches;
            const slopePercentage = slope * 100;
            const slopeAngle = Math.atan(slope) * (180 / Math.PI);
            const slopeRatio = 1 / slope;

            let railingsNeeded = "No";
            let adaCompliant = "Yes, ramp ratio is less than 1:12";
            if (slope > 1/20) {
                railingsNeeded = "Yes";
                if (slope > 1/12) {
                    adaCompliant = `No, ramp ratio (1:${slopeRatio.toFixed(2)}) exceeds 1:12`;
                } else {
                    adaCompliant = `Yes, ramp ratio (1:${slopeRatio.toFixed(2)}) is between 1:12 and 1:20`;
                }
            } else {
                adaCompliant = `Yes, ramp ratio (1:${slopeRatio.toFixed(2)}) is less than 1:20`;
            }

            const resultText = `Slope Percentage: ${slopePercentage.toFixed(1)}%
Slope Angle: ${slopeAngle.toFixed(1)}°
Railings Needed: ${railingsNeeded}
ADA Compliant: ${adaCompliant}`;

            document.getElementById('slopeResult').textContent = resultText;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculateBtn');
            const convertBtn = document.getElementById('convertBtn');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const convertToDecimalFeetBtn = document.getElementById('convertToDecimalFeetBtn');
            const calculateSlopeBtn = document.getElementById('calculateSlopeBtn');

            if (calculateBtn) calculateBtn.addEventListener('click', calculate);
            if (convertBtn) convertBtn.addEventListener('click', convertToMetric);
            if (clearHistoryBtn) clearHistoryBtn.addEventListener('click', clearHistory);
            if (convertToDecimalFeetBtn) convertToDecimalFeetBtn.addEventListener('click', convertToDecimalFeet);
            if (calculateSlopeBtn) calculateSlopeBtn.addEventListener('click', calculateSlope);
        

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('calculateBtn').addEventListener('click', calculate);
            document.getElementById('convertBtn').addEventListener('click', convertToMetric);
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
            document.getElementById('convertToMetricBtn').addEventListener('click', convertFeetAndInchesToMetric);
            document.getElementById('convertToDecimalFeetBtn').addEventListener('click', convertToDecimalFeet);
            document.getElementById('calculateSlopeBtn').addEventListener('click', calculateSlope);
        })});
    </script>
</body>
</html>