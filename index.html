<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Calculators</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1920px;
            margin: 10px;
            padding: 5px, 10px, 5px, 10px;
            box-sizing: border-box;
        }
        h1 {
            text-align: center;
            font-size: 24px;
            color: #e74c3c;
            margin: 5px;
        }
        h2 {
            color: #e74c3c;
            font-size: 18px;
            margin-top: 5px;
            margin-bottom: 10px;
        }
        h3 {
            color: #000000;
            font-size: 16px;  
            margin-bottom: 2px;
            margin-top: 2px;
        }
        .calculator, .converter, .history, .feet-inches-converter, .decimal-feet-converter {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .calc-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .calc-input {
            display: flex;
            align-items: center;
        }
        .fit-columns{
            display: flex;
            flex-direction: row;
        }
        .column-small{
            flex: 1;
            padding: 30px;
        }
        .column-large{
            flex: 1.5;
            padding: 30px;
            border-width: 2px;
            border-style: solid;
            border-width: 5px, 5px, 5px, 5px;
            border-color: rgba(0, 0, 0, 0);
            border-left-color: rgba(0, 0, 0, 0.07);
        }
        input, select {
            margin: 0 5px;
            padding: 5px;
        }
        input[type="number"], input[type="text"] {
            width: 80px;
        }
        select {
            width: 50px;
        }
        button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 0px;
        }
        button:hover {
            background-color: #c0392b;
        }
        #history {
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Architecture Calculators</h1>
    
    <div class="calculator">
        <h2>Feet and Inches Calculator</h2>
        <div class="calc-row">
            <div class="calc-input">
                <input type="number" id="feet1" placeholder="Feet"> ft
                <input type="text" id="inches1" placeholder="Inches"> in
            </div>
        </div>
            <div class="calc-row">
            <select id="operation">
                <option value="+">+</option>
                <option value="-">-</option>
                <option value="*">ร</option>
                <option value="/">รท</option>
            </select>
            </div>
            <div class="calc-input">
                <input type="number" id="feet2" placeholder="Feet"> ft
                <input type="text" id="inches2" placeholder="Inches"> in
            </div>
            <button id="calculateBtn">Calculate</button>
        
        <p id="result"></p>
    </div>

    <div class="converter">
        <h2>Standard to Metric Converter</h2>
        <div class="calc-row">
            <div class="calc-input">
                <input type="number" id="feetToConvert" placeholder="Feet"> ft
                <input type="text" id="inchesToConvert" placeholder="Inches"> in
            </div>
            <button id="convertBtn">Convert to Metric</button>
        </div>
        <p id="metricResult"></p>
    </div>

    <div class="decimal-feet-converter">
        <h2>Feet and Inches to Decimal Feet</h2>
        <div class="calc-row">
            <div class="calc-input">
                <input type="number" id="feet" placeholder="Feet"> ft
                <input type="number" id="inches" placeholder="Inches"> in
            </div>
            <button id="convertToDecimalFeetBtn">Convert to Decimal Feet</button>
        </div>
        <p id="decimal-feet-result"></p>
    </div>

    <div class="slope calculator">
        <h2>Ramp Calculator</h2>
        <div class="calc-row">
            <div class="calc-input">
                <label for="slopeRiseFeet"><h3>Rise:</label></h3>
                <input type="number" id="slopeRiseFeet" placeholder="Feet"> ft
                <input type="text" id="slopeRiseInches" placeholder="Inches"> in
            </div>
            <div class="calc-input">
                <label for="slopeRunFeet"><h3>Run:</label></h3>
                <input type="number" id="slopeRunFeet" placeholder="Feet"> ft
                <input type="text" id="slopeRunInches" placeholder="Inches"> in
            </div>
            <button id="calculateSlopeBtn">Calculate Slope</button>
        </div>
        <div id="slopeResult"></div>
    </div>

    <div class="calculator">
        <h2>Stair Calculator</h2>
        <div class="calc-row">
            <div class="calc-input">
                <label for="totalRiseFeet"><h3>Floor to Floor Height:</label></h3>
                <input type="number" id="totalRiseFeet" min="0" placeholder="Feet"> ft
                <input type="number" id="totalRiseInches" min="0" max="11" placeholder="Inches"> in
            </div>
            <div class="calc-input">
                <label for="runWidthFeet"><h3>Stair Width:</label></h3>
                <input type="number" id="runWidthFeet" min="0" placeholder="Feet"> ft
                <input type="number" id="runWidthInches" min="0" max="11" placeholder="Inches"> in
            </div>
            <button onclick="calculateStairs()">Calculate Stairs</button>
        </div>
        <div class="calc-row">
            <div id="stairResult"></div>
        </div>
    </div>
    

    <div class="history">
        <h2>Calculation History</h2>
        <div id="history">
        </div>
        <button id="clearHistoryBtn">Clear History</button>
    </div>

    <script>
        let calculationHistory = [];

        function addToHistory(calculation) {
            calculationHistory.push(calculation);
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyElement = document.getElementById('history');
            historyElement.innerHTML = calculationHistory.map(calc => `<p>${calc}</p>`).join('');
        }

        function clearHistory() {
            calculationHistory = [];
            updateHistoryDisplay();
        }

        function parseFractionalInput(input) {
            input = input.trim();
            let total = 0;
            let parts = input.split(' ');
            
            for (let part of parts) {
                if (part.includes('/')) {
                    let [numerator, denominator] = part.split('/').map(num => parseFloat(num.trim()));
                    total += numerator / denominator;
                } else {
                    total += parseFloat(part) || 0;
                }
            }
            
            return total;
        }

        function roundToNearestFraction(decimal, denominator) {
            return Math.round(decimal * denominator) / denominator;
        }

function roundToNearestFraction(decimal, denominator) {
    return Math.round(decimal * denominator) / denominator;
}

function toConstructionFraction(decimal) {
    if (decimal == 0) return '0';
    const wholePart = Math.floor(decimal);
    let fractionalPart = decimal - wholePart;
    
    if (fractionalPart < 1/512) {  // Using 1/512 as the threshold for rounding to 0
        return wholePart.toString();
    }
    
    const fractions = [2, 4, 8, 16, 32, 64, 128, 256];
    let bestFraction = { numerator: 0, denominator: 256 };
    let smallestError = Infinity;

    for (let denominator of fractions) {
        const rounded = roundToNearestFraction(fractionalPart, denominator);
        const error = Math.abs(rounded - fractionalPart);
        
        if (error < smallestError) {
            smallestError = error;
            bestFraction = {
                numerator: Math.round(rounded * denominator),
                denominator: denominator
            };
        }
    }

    if (bestFraction.numerator === 0) {
        return wholePart.toString();
    }

    // Simplify the fraction
    const gcd = (a, b) => b ? gcd(b, a % b) : a;
    const divisor = gcd(bestFraction.numerator, bestFraction.denominator);
    bestFraction.numerator /= divisor;
    bestFraction.denominator /= divisor;

    if (wholePart > 0) {
        return `${wholePart} ${bestFraction.numerator}/${bestFraction.denominator}`;
    } else {
        return `${bestFraction.numerator}/${bestFraction.denominator}`;
    }
}

function formatResult(feet, inches) {
    const wholeFeet = Math.floor(feet);
    const totalInches = (feet - wholeFeet) * 12 + inches;
    const wholeInches = Math.floor(totalInches);
    const fractionalInches = totalInches - wholeInches;
    
    let result = '';
    if (wholeFeet > 0) {
        result += `${wholeFeet}'`;
    }
    if (wholeInches > 0 || fractionalInches > 0) {
        if (result) result += '-';
        result += toConstructionFraction(totalInches % 12) + '"';
    }
    return result || '0"';
}

        function calculate() {
            const feet1 = parseFloat(document.getElementById('feet1').value) || 0;
            const inches1 = parseFractionalInput(document.getElementById('inches1').value);
            const feet2 = parseFloat(document.getElementById('feet2').value) || 0;
            const inches2 = parseFractionalInput(document.getElementById('inches2').value);
            const operation = document.getElementById('operation').value;

            const totalInches1 = feet1 * 12 + inches1;
            const totalInches2 = feet2 * 12 + inches2;

            let result;
            switch (operation) {
                case '+':
                    result = totalInches1 + totalInches2;
                    break;
                case '-':
                    result = totalInches1 - totalInches2;
                    break;
                case '*':
                    result = totalInches1 * totalInches2;
                    break;
                case '/':
                    result = totalInches1 / totalInches2;
                    break;
            }

            const resultFeet = Math.floor(result / 12);
            const resultInches = result % 12;

            const resultText = `<span style="color: black;">Result: <span style="color: red;">${formatResult(resultFeet, resultInches)}`;
            document.getElementById('result').innerHTML = resultText;

            const calculationText = `${formatResult(feet1, inches1)} ${operation} ${formatResult(feet2, inches2)} = ${formatResult(resultFeet, resultInches)}`;
            addToHistory(calculationText);
        }

        function convertToMetric() {
            const feet = parseFloat(document.getElementById('feetToConvert').value) || 0;
            const inches = parseFractionalInput(document.getElementById('inchesToConvert').value);

            const totalInches = feet * 12 + inches;
            const totalCentimeters = totalInches * 2.54;

            const meters = Math.floor(totalCentimeters / 100);
            const centimeters = totalCentimeters % 100;
            const millimeters = inches * 25.4;
            const kilometers = meters / 1000;

            const resultText = `<span style="color: black;">Result:<br>${feet}'-${inches}" = <span style="color: red;">${millimeters.toFixed(Math.max(1, getDecimalPlaces(millimeters)))} mm
            <br><span style="color: black;">or <span style="color: red;">${centimeters.toFixed(Math.max(1, getDecimalPlaces(centimeters)))} cm
            <br><span style="color: black;">or <span style="color: red;">${meters.toFixed(Math.max(1, getDecimalPlaces(meters)))} m
            <br><span style="color: black;">or <span style="color: red;">${(meters / 1000).toFixed(Math.max(1, getDecimalPlaces(meters / 1000)))} km`;
            document.getElementById('metricResult').innerHTML = resultText;

            const conversionText = `${formatResult(feet, inches)} = ${meters.toFixed(Math.max(1, getDecimalPlaces(meters)))}m ${centimeters.toFixed(Math.max(1, getDecimalPlaces(centimeters)))}cm`;
            addToHistory(conversionText);
            }

            function getDecimalPlaces(number) {
                const stringNumber = number.toString();
                const decimalIndex = stringNumber.indexOf('.');
                if (decimalIndex === -1) {
                    return 0;
                }
                return Math.min(10, stringNumber.length - decimalIndex - 1);
            }

            function roundToNearestFraction(decimal, denominator) {
                return Math.round(decimal * denominator) / denominator;
            }

        function parseFeetAndInches(input) {
            const regex = /^(\d+)'?-?\s*(\d+\s+(\d+\/\d+)?"?|\d+\/\d+"?|(\d+\/\d+)"?)$/;
            const match = input.match(regex);
            
            if (!match) {
                throw new Error("Invalid input format");
            }
            
            let feet = parseInt(match[1]) || 0;
            let inches = 0;
            
            if (match[2]) {
                if (match[2].includes("/")) {
                    inches = parseFractionalInput(match[2]);
                } else {
                    inches = parseInt(match[2]);
                    if (match[3]) {
                        inches += parseFractionalInput(match[3]);
                    }
                }
            }
            
            return feet * 12 + inches;
        }

        function convertFeetAndInchesToMetric() {
            try {
                const input = document.getElementById('feetAndInches').value;
                const totalInches = parseFeetAndInches(input);
                const totalCentimeters = totalInches * 2.54;

                const meters = Math.floor(totalCentimeters / 100);
                const centimeters = totalCentimeters % 100;

                const resultText = `Result: ${meters} meters and ${centimeters.toFixed(2)} centimeters`;
                document.getElementById('feetInchesMetricResult').textContent = resultText;

                const formattedInput = formatResult(Math.floor(totalInches / 12), totalInches % 12);
                const conversionText = `${formattedInput} = ${meters}m ${centimeters.toFixed(2)}cm`;
                addToHistory(conversionText);
            } catch (error) {
                document.getElementById('feetInchesMetricResult').textContent = "Error: " + error.message;
            }
        }

        function convertToDecimalFeet() {
            const feet = parseFloat(document.getElementById('feet').value) || 0;
            const inches = parseFloat(document.getElementById('inches').value) || 0;
            const decimalFeet = feet + (inches / 12);
            const resultText = `<span style="color: black;">Result:<span style="color: red;">${decimalFeet.toFixed(2)} ft`;
            document.getElementById('decimal-feet-result').innerHTML = resultText;

            const conversionText = `${feet}'-${inches}" = ${decimalFeet.toFixed(2)} ft`;
            addToHistory(conversionText);
        }

        function calculateSlope() {
            const riseFeet = parseFloat(document.getElementById('slopeRiseFeet').value) || 0;
            const riseInches = parseFractionalInput(document.getElementById('slopeRiseInches').value);
            const runFeet = parseFloat(document.getElementById('slopeRunFeet').value) || 0;
            const runInches = parseFractionalInput(document.getElementById('slopeRunInches').value);

            const totalRiseInches = riseFeet * 12 + riseInches;
            const totalRunInches = runFeet * 12 + runInches;

            if (totalRiseInches <= 0 || totalRunInches <= 0) {
                document.getElementById('slopeResult').textContent = "Please enter valid positive numbers for rise and run.";
                return;
            }

            const slope = totalRiseInches / totalRunInches;
            const slopePercentage = slope * 100;
            const slopeAngle = Math.atan(slope) * (180 / Math.PI);
            const slopeRatio = 1 / slope;

            let railingsNeeded = "No";
            let adaCompliant = "Yes, ramp ratio is less than 1:12";
            if (slope > 1/20) {
                railingsNeeded = "Yes";
                if (slope > 1/12) {
                    adaCompliant = `No, ramp ratio (1:${slopeRatio.toFixed(2)}) exceeds 1:12. If not used as a means of egress ramp can be maximum 1:8 per <a href='https://up.codes/viewer/new_york/ibc-2018/chapter/10/means-of-egress#1012.2' target='_blank'>Building Code Section 1012.2</a>.`;
                } else {
                    adaCompliant = `Yes, ramp ratio (1:${slopeRatio.toFixed(2)}) is between 1:12 and 1:20`;
                }
            } else {
                adaCompliant = `Yes, ramp ratio (1:${slopeRatio.toFixed(2)}) is less than 1:20`;
            }

            document.getElementById('slopeResult').innerHTML = `
                <h3>Ramp Parameters</h3>
                <span style="color: black;">Slope as a Percentage: <span style="color: red;">${slopePercentage.toFixed(1)}%
                <br><span style="color: black;">Slope Angle: <span style="color: red;">${slopeAngle.toFixed(1)}ยฐ
                <br><span style="color: black;">Railings Needed?: <span style="color: red;">${railingsNeeded}
                <br><span style="color: black;">ADA Compliant?: <span style="color: red;">${adaCompliant}
                <br>
                <br>Always double check calculations with the <a href='https://up.codes/viewer/new_york/ibc-2018/chapter/10/means-of-egress#1005' target='_blank'>Building Code Section 1005</a>.
            `;
        }

        function calculateStairs() {
            const totalRiseFeet = parseFloat(document.getElementById('totalRiseFeet').value) || 0;
            const totalRiseInches = parseFloat(document.getElementById('totalRiseInches').value) || 0;
            const runWidthFeet = parseFloat(document.getElementById('runWidthFeet').value) || 0;
            const runWidthInches = parseFloat(document.getElementById('runWidthInches').value) || 0;

            const totalRiseInInches = (totalRiseFeet * 12) + totalRiseInches;
            const runWidthInInches = (runWidthFeet * 12) + runWidthInches;

            const maxRiserHeight = 7;
            const treadDepth = 11;

            const numberOfSteps = Math.ceil(totalRiseInInches / maxRiserHeight);
            const actualRiserHeight = totalRiseInInches / numberOfSteps;

            const totalRun = numberOfSteps * treadDepth;
            const numberOfLandings = Math.floor(totalRiseInInches / (12 * 12)); // 12 feet vertically before landing is added
            const totalRunWithLandings = totalRun + (numberOfLandings * runWidthInInches);

            document.getElementById('stairResult').innerHTML = `
            <div class="fit-columns">  
                <div class="column-small">
                    <h3>Stair Parameters</h3>
                    <span style="color: black;">Number of Risers: <span style="color: red;">${numberOfSteps}
                    <br><span style="color: black;">Riser Height: <span style="color: red;">${actualRiserHeight.toFixed(3)}" or ${formatFractionalInches(actualRiserHeight)}
                    <br><span style="color: black;">Tread Depth: <span style="color: red;">11"
                    <br>
                    <h3>Occupancy Loads Acheived Per <a href="https://up.codes/viewer/new_york/ibc-2018/chapter/10/means-of-egress#1005.3.1" target="_blank">Section 1005.3.1</a>:</h3>
                    <span style="color: black;">0.3"/person: <span style="color: red;">${(runWidthInInches*0.03)*100} persons
                    <br><span style="color: black;">0.2"/person (Sprinklered): <span style="color: red;">${(runWidthInInches*0.02)*100} persons
                </div>
                <div class="column-large">
                    <h3>Single Run Stair</h3>
                    <span style="color: black;">Single Run Stair Width (Egress Width):<span style="color: red;">${formatFeetAndInches(runWidthInInches)}
                    <br><span style="color: black;">Run Length Without Landings:<span style="color: red;">${formatFeetAndInches(totalRun)}
                    <br><span style="color: black;">Number of Landings Required:<span style="color: red;">${numberOfLandings} at ${formatFeetAndInches(runWidthInInches)} = ${formatFeetAndInches(numberOfLandings*runWidthInInches)}
                    <br><span style="color: black;">Run Length Including Landings:<span style="color: red;">${formatFeetAndInches(totalRunWithLandings)}
                    <br>${runWidthInInches < 48 && runWidthInInches >= 36 ? "<span style='color: red;'>Warning!: The stair width is less than 48\". Unless the building is sprinklered, the stair IS NOT accessible per <a href='https://up.codes/viewer/new_york/ibc-2018/chapter/10/means-of-egress#1009.3.2' target='_blank'>Section 1009.3.2</a> Make sure at least one means of egress in the building is accessible.</span>" : ""}
                    <br>${runWidthInInches < 36 ? "<span style='color: red;'>Warning!: The stair width is less than 36\". per <a href='https://up.codes/viewer/new_york/ibc-2018/chapter/10/means-of-egress#1009.3.2' target='_blank'>Section 1009.3.2</a> Make sure at least one means of egress in the building is accessible.</span>" : ""}
                </div>
                <div class="column-large">
                    <h3>Switchback Stair</h3>
                    <span style="color: black;">Switchback Stair Shaft Width (Egress Width + 6" Between Runs):<span style="color: red;">${formatFeetAndInches((runWidthInInches*2)+6)}
                    <br><span style="color: black;">Number of Treads: <span style="color: red;">${Math.ceil(numberOfSteps/2)} plus ${Math.floor(numberOfSteps/2)}
                    <br><span style="color: black;">Switchback Stair Shaft Length (Egress Width + 5" Stringer Return Onto Landing): <span style="color: red;">${formatFeetAndInches((runWidthInInches*2)+10+(Math.ceil(numberOfSteps/2)*11))} (5" might be 3", look at typ dtl)
                </div>
            </div>   
            <br><span style="color: red;">Warnings!: 
                <br>- All Egress Widths are taken from outside of stringers, typ.
                <br>- Make sure if there are (2) stair towers, the narrowest stair width is minimally 50% of the overall egress width per <a href='https://up.codes/viewer/new_york/ibc-2018/chapter/10/means-of-egress#1005.5' target='_blank'>Section 1005.5</a>.
                <br>${totalRiseInInches < 12 ? "<span style='color: red;'>- Per <a href='https://up.codes/viewer/new_york/ibc-2018/chapter/10/means-of-egress#1003.5' target='_blank'>Section 1003.5</a>, for a change in elevation of less than 12\" a ramp must be used.</span>" : ""}
                <br>- Always double check calculations with the <a href='https://up.codes/viewer/new_york/ibc-2018/chapter/10/means-of-egress#1005' target='_blank'>Building Code Section 1005</a>.
                    `;
        }

        function formatFeetAndInches(totalInches) {
            const feet = Math.floor(totalInches / 12);
            const inches = totalInches % 12;
            const fractionalInches = formatFractionalInches(inches);
            return `${feet}'-${fractionalInches}`;
        }

        function formatFractionalInches(inches) {
        const wholeNumber = Math.floor(inches);
        const fractionalPart = inches - wholeNumber;

        if (fractionalPart === 0) {
            return `${wholeNumber}"`;
        } else {
            const numerator = Math.round(fractionalPart * 256);
            return `${wholeNumber} ${numerator}/256"`;
        }
        }
        

        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculateBtn');
            const convertBtn = document.getElementById('convertBtn');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const convertToDecimalFeetBtn = document.getElementById('convertToDecimalFeetBtn');
            const calculateSlopeBtn = document.getElementById('calculateSlopeBtn');

            if (calculateBtn) calculateBtn.addEventListener('click', calculate);
            if (convertBtn) convertBtn.addEventListener('click', convertToMetric);
            if (clearHistoryBtn) clearHistoryBtn.addEventListener('click', clearHistory);
            if (convertToDecimalFeetBtn) convertToDecimalFeetBtn.addEventListener('click', convertToDecimalFeet);
            if (calculateSlopeBtn) calculateSlopeBtn.addEventListener('click', calculateSlope);
        

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('calculateBtn').addEventListener('click', calculate);
            document.getElementById('convertBtn').addEventListener('click', convertToMetric);
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
            document.getElementById('convertToMetricBtn').addEventListener('click', convertFeetAndInchesToMetric);
            document.getElementById('convertToDecimalFeetBtn').addEventListener('click', convertToDecimalFeet);
            document.getElementById('calculateSlopeBtn').addEventListener('click', calculateSlope);
        })});
    </script>
</body>
</html>